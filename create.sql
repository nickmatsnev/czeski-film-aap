CREATE TABLE IF NOT EXISTS organizations (id SERIAL PRIMARY KEY,name TEXT NOT NULL UNIQUE,description TEXT,created_at TIMESTAMPTZ DEFAULT now());
CREATE TABLE IF NOT EXISTS inventories (id SERIAL PRIMARY KEY,organization_id INT NOT NULL REFERENCES organizations(id) ON DELETE CASCADE,name TEXT NOT NULL,description TEXT,variables JSONB DEFAULT '{}'::jsonb,created_at TIMESTAMPTZ DEFAULT now());
CREATE TABLE IF NOT EXISTS playbooks (id SERIAL PRIMARY KEY,organization_id INT NOT NULL REFERENCES organizations(id) ON DELETE CASCADE,name TEXT NOT NULL,description TEXT,content TEXT NOT NULL,created_at TIMESTAMPTZ DEFAULT now());
CREATE TABLE IF NOT EXISTS jobs (id SERIAL PRIMARY KEY,organization_id INT NOT NULL REFERENCES organizations(id) ON DELETE CASCADE,playbook_id INT NOT NULL REFERENCES playbooks(id) ON DELETE CASCADE,inventory_id INT REFERENCES inventories(id) ON DELETE SET NULL,status TEXT NOT NULL DEFAULT 'pending',started_at TIMESTAMPTZ DEFAULT now(),finished_at TIMESTAMPTZ,extra_vars JSONB DEFAULT '{}'::jsonb,result JSONB,created_at TIMESTAMPTZ DEFAULT now());
